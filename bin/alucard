#!/usr/bin/env bash

# Color converter using Dracula theme as base
# https://github.com/dracula/dracula-theme
# Usage:
# alucard dracula.json
# alucard dracula.json > custom.json
# alucard -i dracula.json

# Check -i argument
while [[ $# -gt 0 ]]; do
  case "$1" in
    -i)
      overwrite=true
      shift
      ;;
    *)
      file="$1"
      shift
      ;;
  esac
done

# Check if file
if [[ ! -f "$file" ]]; then
  echo 'alucard: no file in argument'
  exit 1
fi

# Create arrays
declare -A custom dracula

# Custom
custom[background]='23272e'
custom[currentline]='2c313c'
custom[selection]='3d4556'
custom[foreground]='abb2bf'
custom[comment]='5c6370'
custom[blue]='61afef'
custom[cyan]='56b6c2'
custom[green]='98c379'
custom[orange]='d19a66'
custom[pink]='c678dd'
custom[purple]='c678dd'
custom[red]='e06c75'
custom[yellow]='e5c07b'
custom[brightblack]=${custom[background]}
custom[brightblue]=${custom[blue]}
custom[brightcyan]=${custom[cyan]}
custom[brightgreen]=${custom[green]}
custom[brightpurple]=${custom[purple]}
custom[brightred]=${custom[red]}
custom[brightwhite]=${custom[foreground]}
custom[brightyellow]=${custom[yellow]}

# Dracula
dracula[background]='282a36'
dracula[currentline]='44475a'
dracula[selection]='44475a'
dracula[foreground]='f8f8f2'
dracula[comment]='6272a4'
dracula[blue]='bd93f9'
dracula[cyan]='8be9fd'
dracula[green]='50fa7b'
dracula[orange]='50fa7b'
dracula[pink]='ff79c6'
dracula[purple]='ff79c6'
dracula[red]='ff5555'
dracula[yellow]='f1fa8c'
dracula[brightblack]='6272a4'
dracula[brightblue]='d6acff'
dracula[brightcyan]='a4ffff'
dracula[brightgreen]='69ff94'
dracula[brightpurple]='ff92df'
dracula[brightred]='ff6e6e'
dracula[brightwhite]='ffffff'
dracula[brightyellow]='ffffa'

# Loop for colors
for color in "${!dracula[@]}"; do
  sed_args+="s/${dracula[$color]}/${custom[$color]}/gI;"
done

# Substitute colors
if [[ $overwrite ]]; then
  if sed -Ei "$sed_args" "$file"; then
    echo 'alucard: substitute done'
  fi
else
  sed -E "$sed_args" "$file"
fi
